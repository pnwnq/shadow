# 开发计划 (To-Do List 格式)

本文档旨在以任务清单的形式，清晰地追踪项目进展、当前任务和未来计划。

---

## 一、核心决策与已完成事项

- [x] **项目重启决策:** 放弃之前可能存在环境冲突的工作目录，**基于一个干净的、仅包含源代码的项目结构重新开始**，以确保环境的纯净和统一。
- [x] **架构选型:** 确定采用 **Next.js 全栈应用（本地开发）与云数据库（优先考虑 Sealos 托管）相结合的模式**。
- [x] **技术栈确认:** 基于 Next.js、React、TypeScript、Prisma、Tailwind CSS、`pnpm` 包管理器等。
- [x] **源代码完成:** 已具备大部分核心功能模块的 UI 实现和后端 API 骨架。
- [x] **需求与计划文档化:** 创建了 `需求分析.md` 和本 `开发计划.md`。
- [x] **功能范围界定:** 明确指示**暂缓财务模块** (`app/finance/`) 的开发和优化。
- [x] **环境配置与数据库迁移:**
  - [x] **配置云数据库连接:** 成功连接到 Sealos 上的 PostgreSQL 数据库。
  - [x] **解决连接问题:** 解决了数据库外网访问、环境变量加载 (`dotenv-cli`) 等问题。
  - [x] **同步数据库模式:** 使用 `prisma migrate reset` 成功根据 `schema.prisma` 初始化了云端数据库表结构。
- [x] **核心认证功能端到端实现:**
  - [x] **注册流程:** 创建并完整调试了 `/api/auth/register` 接口，解决了 `bcrypt` 兼容性、Prisma Client 实例化和数据库连接池等多个后端问题。
  - [x] **登录流程:** 搭建了 `app/api/auth/[...nextauth]/route.ts`，配置了 `credentials` 登录处理器，并注入了 `NEXTAUTH_SECRET`。
  - [x] **角色系统:** 在数据库中定义了全局角色 (`Role`)，并扩展了 NextAuth 的 `session` 和 `user` 类型，成功将会话与用户角色、状态等信息关联。
- [x] **架构重构与数据真实化:**
  - [x] **遵循最佳实践:** 重构了 `/home` 和 `/profile` 页面，分离服务器组件 (负责数据获取) 和客户端组件 (负责交互 UI)，解决了 `async Client Component` 错误。
  - [x] **修复客户端错误:** 通过 `suppressHydrationWarning` 解决了 `next-themes` 导致的 Hydration Mismatch 问题。
  - [x] **数据对接:** 将 `/home` 和 `/profile` 页面的核心内容替换为真实的后端用户数据。

---

## 二、当前与后续任务 (Action Items)

### **阶段一：后端 API 开发 (在 Next.js API Routes 中)**

- [ ] **用户认证与授权 API:**
  - [x] 注册、邮箱密码登录功能已调试通过。
  - [ ] **完善和测试** GitHub 等第三方登录流程。
  - [ ] 实现并完善基于角色的**页面级和组件级**权限控制逻辑。
- [ ] **项目管理 API:** 实现 CRUD 操作，成员管理，任务管理等。
- [ ] **物品管理 API:** 实现物品信息 CRUD，NFC 绑定，借用/归还记录，库存状态更新。
- [ ] **文档管理 API:** 实现文件上传 (考虑大文件)、下载、信息管理、内容提取 API。
- [ ] **竞赛管理 API:** 实现 CRUD 操作，并处理与项目、任务、文件等的关联。
- [ ] **AI 助手 API:** 对接真实的 AI 模型或服务 (替换现有模拟 API)。
- [ ] **其他核心 API:**
  - [ ] 用户设置与个人资料 API。
  - [ ] 通知系统 API。
  - [ ] 管理员后台 API (用户管理、系统设置等)。
- [ ] **代码清理:**
  - [ ] 移除项目中不再使用的模拟数据文件。
  - [ ] 删除未使用的代码文件或组件。

### **阶段二：前后端集成与功能完善**

- [ ] **全面 API 对接:**
  - [x] 已完成 `/home` 和 `/profile` 页面的数据真实化。
  - [ ] **继续**将所有前端页面和组件的模拟数据调用，替换为对真实后端 API 的调用 (例如：导航栏、侧边栏的用户信息)。
  - [ ] 确保 Zustand 等状态管理库与后端数据的同步逻辑正确高效。
- [ ] **核心功能端到端实现:**
  - [ ] 完成项目管理模块的完整功能。
  - [ ] 完成物品管理模块的完整功能 (包括 NFC 关联的后端逻辑)。
  - [ ] 完成文档管理模块的完整功能。
  - [ ] 完成竞赛管理模块的完整功能。

### **阶段三：测试、优化与部署**

- [ ] **深化测试:**
  - [ ] 为所有核心功能模块编写全面的端到端测试 (Playwright)。
  - [ ] 增加更多边界条件和异常情况的测试用例。
- [ ] **性能优化:**
  - [ ] 分析并优化页面加载速度和 API 响应时间。
  - [ ] 对大数据量列表进行分页或虚拟化处理。
- [ ] **部署准备:**
  - [ ] 准备生产环境的配置文件。
  - [ ] 将项目完整部署到 Vercel 或 Sealos 平台。
- [ ] **持续集成/持续部署 (CI/CD):** (待项目稳定后引入) 规划并搭建自动化构建、测试和部署的流水线。

---

## 三、AI 辅助开发流程实践 (持续进行)

- [ ] **Sealos:**
  - [x] **决策:** 使用其数据库托管能力。
  - [x] **实践:** 在项目开发中持续利用其云服务能力。
  - [ ] **探索:** 探索使用 Sealos 进行最终的应用部署。
- [ ] **Cursor (编辑器):** 在编码、重构、调试和文档编写过程中，持续利用其 AI 能力。
- [ ] **Vercel v0:** 在需要快速搭建新页面或组件原型时，利用其从文本生成 UI 的能力。

---

_本文档将根据项目进展持续更新。_
