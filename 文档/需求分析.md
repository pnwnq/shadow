# "Shadow" 实验室/团队管理系统 - 综合需求分析文档 (V3)

## 1. 项目背景与愿景

### 1.1 背景

本项目起源于实验室/团队在日常运营中遇到的挑战，包括：

- 资料查找困难、知识传承不畅、新成员学习成本高。
- 物品管理混乱、追踪困难、易丢失。
- 项目进度不透明、任务分配不清、**各模块信息孤立**。
- 特定活动（如学科竞赛）的采购与报账流程繁琐、不规范。

### 1.2 项目愿景

旨在创建一个全面、高效、智能的实验室/团队管理系统 "Shadow"，如影子般在后台提供支持，核心目标是：

- **提升运营效率:** 简化管理流程，减少重复劳动。
- **降低学习门槛:** 提供结构化的学习资源和指导。
- **加强资源管理:** 实现物品、文档等资源的数字化和可追溯管理。
- **规范财务流程:** 为特定活动提供清晰的财务管理支持。
- **促进协作透明:** 改善项目和任务的可见性，**并将项目管理作为核心枢纽，连接人员、物品、文档和特定活动（如竞赛），打破信息孤岛**。

## 1.bis 当前技术栈概览

根据项目 `package.json` 文件及相关配置文件分析，当前项目主要采用以下技术栈：

- **核心框架与库:**

  - **Next.js (v15.2.4):** 用于构建服务器端渲染 (SSR) 和静态站点生成 (SSG) 的 React 框架。
  - **React (v19):** 用于构建用户界面的 JavaScript 库。
  - **TypeScript (v5):** JavaScript 的超集，提供静态类型检查。

- **UI 与样式:**

  - **Tailwind CSS (v3.4.17):** 原子化的 CSS 框架，用于快速 UI 构建。
  - **shadcn/ui :** 基于 Radix UI 和 Tailwind CSS 的组件集合，通过 CLI 工具集成。
  - **@radix-ui/react-\*:** 无样式的、可访问的 React UI 组件库。
  - **lucide-react:** SVG 图标库。
  - **tailwindcss-animate:** Tailwind CSS 动画插件。
  - **class-variance-authority (CVA):** 创建可组合的、类型安全的 CSS 类变体。
  - **clsx:** 条件性组合类名工具。
  - **tailwind-merge:** 合并 Tailwind CSS 类名，解决冲突。
  - **next-themes:** Next.js 应用主题切换（如暗黑模式）。

- **表单处理:**

  - **React Hook Form (v7.54.1):** 高性能 React 表单库。
  - **Zod (v3.24.1):** TypeScript 优先的模式声明和验证库，常与 React Hook Form 配合。

- **状态管理与数据请求 (根据 Next.js 生态推测):**

  - Next.js 内建功能 (如 `useState`, `useEffect`, Context API, Server Components, Route Handlers) 可能被用于状态管理和数据请求。
  - 也可能使用如 SWR 或 React Query 等库进行更复杂的数据管理 (需进一步确认)。

- **其他常用库与工具:**

  - **cmdk:** 命令面板组件。
  - **date-fns:** JavaScript 日期工具库。
  - **embla-carousel-react:** 轻量级轮播组件。
  - **input-otp:** 一次性密码输入组件。
  - **react-day-picker:** 日期选择器组件。
  - **react-dropzone:** 文件拖放上传组件。
  - **react-resizable-panels:** 可调整大小面板组件。
  - **recharts:** React 图表库。
  - **sonner:** Toast 通知库。
  - **vaul:** 可拖拽抽屉组件。

- **开发与构建工具:**
  - **pnpm:** 包管理工具 (根据 `pnpm-lock.yaml` 文件推测)。
  - **PostCSS:** CSS 转换工具。
  - **Autoprefixer:** 自动添加 CSS 浏览器前缀。

## 1.ter 架构选型与数据管理

项目将采用 **Next.js 全栈应用（本地开发）与云数据库相结合的模式**。具体而言：

- **应用架构:** 前端界面、交互逻辑以及后端 API 服务均在同一个 Next.js 项目中开发和管理。这有助于保持开发流程的统一性和高效性，特别是在项目初期和中小型团队中。
- **数据库:** 核心数据将存储在云平台上托管的数据库实例中（优先考虑使用 Sealos 提供的数据库服务）。本地开发环境中的 Next.js 应用将直接连接此云数据库实例进行数据读写。Prisma 将作为 ORM 用于数据库的 schema 定义、迁移和数据操作。
- **优势:** 这种方式结合了本地全栈开发的便捷性与云数据库的易管理性、高可用性和可扩展性。开发者可以专注于应用逻辑，而将数据库的运维工作交给云平台。

## 2. 项目目标

- **核心目标:** 交付一个稳定、可用、覆盖核心管理需求的平台，实现人员、物品、文档、项目和特定财务流程的初步数字化管理，**并以项目管理为中心，实现各模块的有效联动**。
- **具体目标:**
  - 实现安全的身份认证和灵活的角色权限控制。
  - 提供可靠的物品追踪功能，特别是针对贵重/关键物品的 NFC 集成，减少物品丢失。
  - 建立集中的文档知识库，方便查找、共享和版本管理，**并能与项目关联**。
  - **[核心连接器]** 提供清晰的项目和任务跟踪能力，**作为串联物品使用、文档沉淀、竞赛活动等信息的中心节点**。
  - 为特定群体（如学科竞赛组）提供标准化的采购与报账流程，**并能与相关项目关联**。
  - 集成 AI 能力，辅助学习和信息检索。
  - 提供现代化、用户友好的操作界面。
  - 搭建稳定、可扩展的技术架构。

## 3. 用户角色与权限 (初步整合)

系统需支持多级用户角色，并实现基于角色的访问控制 (RBAC)。初步设想包含：

- **超级管理员:**
  - 拥有最高权限，负责系统配置、用户管理、角色分配。
  - 管理物品分类、NFC 标签关联。
  - 管理文档分类与标签。
  - 查看所有系统数据（物品、文档、项目、财务记录）。
- **管理员:**
  - 用户管理、角色分配。
  - 管理物品分类、NFC 标签关联。
  - 管理文档分类与标签。
  - 查看所有系统数据（物品、文档、项目、财务记录）。
- **普通成员:**
  - 管理特定项目，分配任务。
  - 查看项目相关数据。
  - 实验室/团队主要使用者。
  - 查看个人名下或公共物品，进行借还操作（手动或 NFC）。
  - 上传/查阅/搜索权限范围内的文档。
  - 参与项目，更新任务状态。
  - 查看个人相关信息和通知。
  - 提交与学科竞赛相关的采购申请。
  - 提交与学科竞赛相关的报账申请。
- **学科竞赛报账组成员 :**
  - 查看采购、报账状态及预算（如果实现）。
  - 审批关键流程（如采购、报账 - 可配置）。

## 4. 功能性需求

### 4.1 核心基础与通用功能

- **用户认证与管理:**
  - 用户注册、登录（用户名/密码）、登出。
  - **[整合]** 支持 GitHub 第三方登录。
  - 用户信息管理（管理员操作）。
  - 角色分配与权限控制 (RBAC)。
- **通知与消息系统 (未来):**
  - 系统公告发布。
  - 重要事件（如：借物到期、审批通知）提醒。

### 4.2 物品管理系统

- **物品信息管理:**
  - 物品录入（名称、型号、序列号、购买日期、价格、负责人、存放地点、当前状态、所属分类/标签等）。
  - 支持管理员配置物品分类和标签。
- **库存状态管理:**
  - 实时显示物品状态
- **借还流程:**
  - **[整合/核心]** 支持手动选择物品进行借用登记和归还登记。
  - **[整合/核心]** 记录物品借还时间、借用人、归还人。
  - **[整合/核心]** **NFC 集成:**
    - 系统记录物品是否关联 NFC 标签 ID 或信息。
    - **[重点]** 为特定物品（贵重、个人、关键设备）优先实现 NFC 关联。
    - 支持通过读取 NFC 标签快速识别物品、跳转详情页或触发借还操作（需配合硬件/App）。
    - 列表页明确标识 NFC 启用状态。
- **列表与查询:**
  - 提供物品列表视图，支持按名称、分类、状态、负责人、是否启用 NFC 等条件进行筛选和搜索。
- **使用记录追踪 :**
  - 记录物品的主要使用历史。

### 4.3 文件与知识管理系统

- **上传与存储:**
  - 支持多种专业文件格式上传：
    - 通用文件：PDF, Word, Excel, PPT 等
    - 设计文件：CAD 图纸（.dwg, .dxf）、3D 模型（.stl, .step, .obj）
    - 工程文件：PCB 设计（.pcb）、电路图（.sch）
    - 代码文件：各类编程语言源代码
    - 图片文件：常见图片格式（.jpg, .png, .gif 等）
    - 专业软件文件：如 RZ 法相关文件、仿真文件等
  - 集成文件存储方案，支持大文件存储和版本控制。
- **列表与查看:**
  - 提供多种视图（列表、网格、缩略图）。
  - 支持按名称、上传者、分类、标签、**关联项目**等排序和筛选。
  - 支持文件类型图标显示，便于快速识别。
- **基础信息与预览:**
  - 查看文件基本信息（大小、类型、创建时间、修改时间等）。
  - **[核心]** 支持多种格式的在线预览：
    - 文档类：PDF, Word, Excel 等
    - 图片类：常见图片格式
    - 代码类：支持语法高亮
    - 设计类：CAD 图纸预览（需集成专业查看器）
    - 3D 模型：支持基础 3D 预览
- **搜索功能:**
  - **[MVP]** 基于标题、文件名、标签、**关联项目**的基础数据库 `LIKE` 搜索。
  - **[未来]** 基于 ElasticSearch 的全文搜索，支持内容搜索、高级组合查询、结果高亮。
  - 支持按文件类型、创建时间、修改时间等元数据搜索。
- **分类与标签:**
  - 支持管理员创建和管理树形分类及标签。
  - 成员可按分类/标签浏览。
  - **支持将文件关联到特定的项目或任务。**
  - 支持自定义文件类型分类。
- **权限控制:**
  - 实现基于角色的文件访问、上传、管理权限。
  - 支持对特定类型文件的特殊权限控制。
- **[未来] 版本管理:**
  - 文件版本历史记录。
  - 版本对比、回滚。
  - 支持大文件的增量存储。
- **[未来] 在线编辑:**
  - 支持 Markdown 或富文本在线编辑与自动保存。
  - 支持基础代码在线编辑。
  - 支持简单 CAD 图纸在线编辑（需集成专业编辑器）。
- **[未来] 文件共享:**
  - 生成共享链接（可设置密码、有效期）。
  - 支持文件在线协作编辑。
  - 支持文件批量导出和打包下载。

### 4.4 项目与任务管理系统

**[核心连接器] 本模块是连接系统其他核心功能的枢纽。**

- **项目创建与管理:**
  - 管理员或指定角色创建项目（名称、描述、起止时间等）。
  - **[新增] 支持将项目与特定的物品（如项目专用设备）、文档（如项目报告、设计文档）、学科竞赛活动等进行关联。**
- **成员管理:**
  - 将系统用户分配到项目中。
- **任务管理:**
  - 项目内创建任务
  - **[新增] 支持在任务中引用或关联相关文档。**
  - **[新增] 支持记录任务执行过程中涉及的物品使用情况（如借用特定设备）。**
  - 任务状态跟踪
  - 任务分配给项目成员。
- **列表与查看:**
  - 提供项目列表和项目内的任务列表（可按状态、负责人等过滤）。
  - **[新增] 在项目详情页展示关联的物品、文档、任务、竞赛活动信息等。**
- **[未来] 复杂功能:**
  - 甘特图、看板视图。
  - 任务依赖关系。

### 4.5 学习路径与资源系统

- ** 基础资源列表:**
  - 手动录入和维护或者 ai 创建学习资源（文档链接、教程链接、书籍推荐、元器件指南等）。
  - 支持对资源进行分类（如：入门、硬件、软件、AI 等）。
- **AI 驱动学习路径:**
  - 结合 AI 技术生成个性化学习路径建议。
  - 根据用户背景和目标推荐学习资源。
  - 分阶段学习指导。

### 4.6 AI 智能助手

- **本地知识库构建:**
  - 整合实验室文档、设备手册、历史问答等数据。
  - 使用向量数据库存储。
- **智能问答:**
  - 提供基于本地知识库的问答机器人。
  - 支持自然语言查询实验室信息（如："如何使用 XX 设备？"、"XX 传感器在哪？"）。
- **智能推荐:**
  - 根据用户当前任务或浏览内容推荐相关文档或资源。

### 4.7 学科竞赛报账组模块

**核心痛点:** 当前采购与报账流程依赖大量手动登记信息（如商品名、下单时间、价格、发票号等）到表格，耗时且易出错。

**核心功能 (高优先级/MVP): 自动化信息录入与导出**

- **智能识别与提取:**
  - **[核心]** 支持用户上传**发票照片、订单截图**或粘贴订单文本。
  - **[核心]** 系统利用**智能图像识别 (OCR) 技术**或特定格式解析，尝试自动识别并提取关键信息（商品名称、数量、单价、总价、下单时间、订单号、发票号码等）。
- **结构化记录创建:**
  - 将提取的信息自动填充到系统内的结构化采购/报账记录中。
  - 允许用户对自动提取的信息进行确认、补充或修改。
- **格式化导出:**
  - 支持将选定的采购/报账记录导出为特定格式的文件（如 Excel `.xlsx`），方便后续处理、存档或提交给相关部门。
  - **[新增] 支持将报账记录与特定的项目或活动关联。**

**其他相关功能:**

- **采购申请管理:**
  - 允许报账组成员手动提交采购申请（作为自动录入的补充，或用于无电子凭证的情况）。
  - **支持在采购申请时关联对应的项目。**
  - 支持配置审批流程
  - 记录申请状态
  - 审批意见记录。
- **报账管理:**
  - 允许报账组成员基于已创建的记录（自动或手动）发起报账流程。
  - **支持在报账时关联对应的项目。**
  - 关联上传的发票、支付凭证等电子附件。
  - 记录报账金额、实际支出、支付方式等。
  - 支持配置报账审批流程。
  - 记录报账状态（待审批、审批中、已批准、已拒绝、已支付）。
  - 支持对已完成报销的记录进行标记或归档。
- ** 报表统计:**
  - 生成指定时间范围内的采购明细报表。
  - 生成指定时间范围内的报账明细报表。
  - 按项目、类别或时间统计支出。

### 4.8 竞赛管理模块

**定位:** 连接项目、学习、文档和财务。

- **竞赛信息管理:**
  - 管理员或指定角色可创建/编辑竞赛信息
  - 支持设置竞赛状态
- **竞赛列表与视图:**
  - 提供竞赛列表，支持按状态、时间、级别等筛选和排序。
  - 可能提供日历视图或时间线视图。
- **核心关联功能:**
  - **关联项目/任务:** 将竞赛与 `4.4 项目管理系统` 中的备赛项目或具体任务双向关联。
  - **关联文档/资源:** 允许将 `4.3 文件系统` 中的文档（往届资料、模板、方案）和 `4.5 学习资源` 与特定竞赛关联，形成竞赛知识库。
  - **关联采购/报账:** 将 `4.7 报账组模块` 中的采购申请或报账记录与特定竞赛关联，便于追踪竞赛支出。
- **成果记录:**
  - 记录竞赛结果、排名、获奖等级。
  - 支持上传获奖证书、照片、总结报告等附件。

### 4.9 其他设想功能

- **拍照签到系统:** 用于活动或实验室出入记录。
- **游戏化功能:** 积分系统、任务成就，激励用户参与。
- **微信公众号集成:** 推送通知、提供部分查询功能。
- **团建功能拓展:** 活动组织、报名等。

## 5. 非功能性需求

- **可用性 & 用户体验:**
  - 系统稳定可靠，核心功能必须顺畅运行。
  - 界面简洁直观，符合现代 Web 应用设计规范。
  - 操作流程清晰、易于理解，减少用户学习成本。
  - 提供必要的提示和反馈。
- **性能:**
  - 常规操作（页面加载、列表查询、数据提交、文件上传下载）需有可接受的响应速度。
  - 对于大数据量列表（如物品、文档）需要考虑分页和优化查询。
- **安全性:**
  - 安全的密码存储（哈希加盐）。
  - 有效的身份验证和授权机制 (RBAC)。
  - 防止常见的 Web 攻击（如 XSS, CSRF, SQL 注入）。
  - 对敏感数据（如财务信息）考虑加密存储。
- **可维护性 & 可扩展性:**
  - 代码结构清晰，遵循良好编程规范和设计模式。
  - 模块化设计，便于未来功能扩展和维护。
  - 提供必要的文档（代码注释、API 文档、部署文档）。
- **兼容性:**
  - 前端兼容主流现代浏览器（Chrome, Firefox, Edge, Safari）。
  - 考虑响应式设计，适应不同屏幕尺寸（桌面优先，移动端兼容）。
- **NFC 交互:**
  - 需要明确与 NFC 读取设备（手机 App/专用读卡器）的交互方式（API 接口定义）。
  - 考虑网络延迟和错误处理。

## 6. 部署考虑

- **数据库部署:** 项目数据库将托管在云平台（如 Sealos），确保数据的可靠性和可访问性。
- **应用部署:** 初期，Next.js 应用可能通过 Vercel 或类似的 PaaS 平台进行部署。未来，随着项目复杂度的增加和对运维自主性要求的提高，可以考虑将整个 Next.js 应用打包成 Docker 镜像，并使用 Sealos 进行统一的云原生部署和管理。
