# 后端开发记录

本文档记录了 Shadow 实验室管理系统后端开发的关键节点和决策。

## 文档管理系统 (核心功能已完成)

此阶段的核心目标是为系统构建一个全新的、独立且功能完善的文档管理模块。我们采用了成熟的开源库与云服务相结合的方案，以确保用户体验和系统的可扩展性。

### 核心技术栈

- **前端 UI**: 使用 **Uppy** 库（`@uppy/react`），提供了一个功能丰富的拖拽上传仪表盘。
- **文件存储**: 使用 **Vercel Blob** 服务，作为高可用的云端对象存储。
- **元数据管理**: 所有文件的元数据（如文件名、URL、上传者等）存储在项目的 **PostgreSQL** 数据库中，通过 **Prisma** 进行管理。
- **文档预览**: PDF 预览采用 `react-pdf` 库；Office 文档预览采用 Microsoft Office Web Viewer。

### 已完成的工作

1.  **数据库与 API 搭建**

    - **数据模型**: 在 `prisma/schema.prisma` 中新增了 `Document` 模型，并建立了与 `User` 模型的关联。
    - **后端接口**: 创建了 `/api/upload` 路由，负责处理文件上传。该接口能验证用户会话、解析 `multipart/form-data` 请求、将文件流存入 Vercel Blob，并最终将文件元数据写入数据库。

2.  **端到端流程打通 (本地 & 云端)**

    - **本地环境**: 解决了 `pnpm` 与 Prisma 的集成问题，补全了 Uppy 的所有对等依赖，并配置了 `.env.local` 使本地开发环境能成功上传文件。
    - **云端部署**: 打通了从 `git push` 到触发 Vercel 自动部署的 CI/CD 流程。
    - **构建错误修复**: 通过在 `package.json` 中为 `build` 命令添加 `prisma generate`，解决了 Vercel 缓存导致的 Prisma Client 初始化失败问题，应用已能成功部署。
    - **服务关联**: 成功将 Vercel 项目、Vercel Blob 存储服务关联，并获取了 `BLOB_READ_WRITE_TOKEN` 完成了本地开发授权。

3.  **初步功能实现**

    - **上传页面**: 创建了 `/documents/upload` 页面，集成了 Uppy `Dashboard` 组件，并实现了组件的中文化。
    - **文件列表**: 创建了 `/documents` 主页面，用于展示所有已上传的文件列表。
    - **详情页面**: 创建了 `/documents/[id]` 详情页面（目前为静态数据）。

4.  **云端环境调试与登录问题修复**
    - **问题**: 迁移至云端环境后，出现 `401 Unauthorized` 登录失败问题。
    - **结果**: 成功解决了登录问题，为后续开发扫清了障碍。

### 当前状态与后续计划

- **当前状态**: 文档管理模块的核心功能，包括上传、下载、列表、详情、删除、预览及分类管理等已开发完成并经过多轮调试。系统已完全迁移至云端开发环境，所有已知问题均已修复。

- **后续计划**:
  1.  **迁移并配置云端开发环境**:
      - **状态**: **已完成**。
  2.  **完成并测试文档预览功能**:
      - **状态**: **已完成**。
  3.  **整合增强版上传页面**:
      - **状态**: **已完成**。
  4.  **详情页功能真实化**:
      - **状态**: **已完成**。

---

## 社区功能 (新功能规划)

此阶段的核心目标是构建一个集帖子发布、实时聊天、好友关系和成员展示于一体的互动社区模块，增强用户间的交流与协作。

### 核心模块规划

- **帖子系统 (`/community/posts`)**: 实现一个论坛或动态墙功能，用户可以创建、浏览、回复和点赞帖子。
- **成员中心 (`/community/members`)**: 展示所有社区成员的列表，并提供搜索和筛选功能。点击成员可跳转至其个人主页。
- **好友系统 (`/community/friends`)**: 允许用户发送好友请求、接受或拒绝请求，并管理自己的好友列表。
- **实时聊天 (`/community/chat`)**: 构建一个实时消息系统，支持用户与好友进行一对一的私信聊天。

### 当前状态与后续计划

- **当前状态**: 已完成初步的文件结构搭建，包含各模块的基本路由和页面框架。
- **后续计划**:
  1. **完善数据库模型**:
     - **目标**: 在 `prisma/schema.prisma` 中为帖子 (`Post`)、评论 (`Comment`)、点赞 (`Like`)、好友关系 (`Friendship`) 和聊天消息 (`Message`) 等功能设计并添加新的数据模型。
     - **状态**: **待办**。
  2. **后端 API 开发**:
     - **目标**: 为上述每个核心模块开发完整的 CRUD 后端接口。
     - **状态**: **待办**。
  3. **前端功能实现**:
     - **目标**: 基于已有的页面框架，利用后端 API 实现所有社区功能的前端交互逻辑和 UI 展示。
     - **状态**: **待办**。

---

## 角色系统（已归档）

此阶段的目标是建立一个稳定、安全且可扩展的用户角色与权限系统，并完成与前端的初步对接... (细节已省略)
